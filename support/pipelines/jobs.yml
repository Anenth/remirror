parameters:
  name: '' # defaults for any parameters that aren't specified
  vmImage: ''

jobs:
  - ${{ if eq(parameters.name, 'Linux') }}:
      - job: ${{ parameters.name }}Checks
        pool:
          vmImage: ${{ parameters.vmImage }}
        steps:
          - template: yarn-install.yml
          - bash: |
              yarn ci:checks
            displayName: 'Run all checks'

  - ${{ if eq(parameters.name, 'Linux') }}:
      - job: ${{ parameters.name }}UnitTests
        pool:
          vmImage: ${{ parameters.vmImage }}
        steps:
          - template: yarn-install.yml
          - bash: |
              yarn test
            displayName: 'Run unit tests'

  - job: ${{ parameters.name }}IntegrationTests
    pool:
      vmImage: ${{ parameters.vmImage }}
    steps:
      - template: yarn-install.yml
      - bash: yarn build
        displayName: 'Build project'
      - bash: yarn test:puppeteer
        displayName: 'Run integration tests on chrome'
      # TODO: Firefox tests are currently failing for several reasons so the result is ignored
      - bash: yarn test:puppeteer:firefox || true
        displayName: 'Run integration tests on firefox'
